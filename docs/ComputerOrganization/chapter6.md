---
comments : true
---

# Chapter6 I/O System



## 引言

从现在起，我们进入了计算机体系结构的最后一个大板块：**输入/输出系统（I/O System）**。

如果说 CPU 是大脑，存储器是记忆，那么 I/O 系统就是大脑与外界沟通的“感官”和“肢体”。I/O 系统的设计核心目标是：**处理极其缓慢的外设与极其快速的 CPU 之间的速度鸿沟。**

------

**I/O 系统的三要素**

要让 CPU 能够控制一个硬盘或键盘，必须具备三个基本组件：

1. **I/O 设备**：物理设备本身（如 SSD、显卡、键盘）。
2. **I/O 控制器（适配器/接口）**：连接 CPU 和设备的中间硬件。它负责解释 CPU 的指令，转换成信号去驱动设备。
3. **I/O 软件（驱动程序）**：操作系统中负责管理硬件的代码。

------

**CPU 如何给 I/O 设备下令？**

CPU 不能直接和键盘讲话。它必须通过**地址**来找到设备。这里有两种主流的编址方式：

**A. 存储器映射 I/O (Memory-Mapped I/O)**

- **原理**：把 I/O 设备的控制寄存器直接看作是“内存地址”的一部分。
- **操作**：CPU 使用普通的 `store` 指令写某个特殊地址，就是在发指令；使用 `load` 读取该地址，就是在获取设备状态。
- **应用**：RISC-V, ARM, MIPS 等现代架构普遍采用。

**B. 独立 I/O 编址 (I/O Mapped I/O)**

- **原理**：I/O 设备有自己独立的地址空间，不占用内存地址。
- **操作**：需要专门的 CPU 指令，比如 x86 中的 `IN` 和 `OUT`。

------

**CPU 如何与设备同步？（三种演进方式）**

这是 I/O 系统最核心的知识点，代表了从初级到高级的三个阶段：

**阶段一：程序查询方式 (Polling)**

- **逻辑**：CPU 不断地在一个循环里询问设备：“好了吗？好了吗？”
- **缺点**：极其浪费 CPU 资源。就像你一直在门口等外卖，什么事也做不了。

**阶段二：中断驱动方式 (Interrupt-driven I/O)**

- **逻辑**：CPU 下达指令后就去干别的任务。当设备准备好了，会发送一个硬件电信号（中断）给 CPU，强行让 CPU 停下当前工作去处理数据。
- **优点**：解放了 CPU，提高了并发性。

**阶段三：直接存储器访问 (DMA - Direct Memory Access)**

- **逻辑**：即便有中断，如果数据量很大（比如从硬盘读 4GB 数据），CPU 搬运数据也会累死。于是我们引入一个专门的“搬运工”——**DMA 控制器**。
- **过程**：CPU 告诉 DMA：“把硬盘 A 地址的 1GB 拷贝到内存 B 地址，搞定了再叫我。” 然后 CPU 就彻底撒手不管了。

------

**I/O 的性能评价**

评价一个 I/O 系统好坏，通常看两点：

1. **吞吐量 (Throughput)**：单位时间内传输的数据总量（如 SSD 的写入速度 5GB/s）。
2. **响应时间 (Response Time)**：从发起请求到得到回应的延迟（如鼠标点击的延迟）。

------



##