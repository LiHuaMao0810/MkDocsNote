
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lihuamao0810.github.io/MkDocsNote/ComputerOrganization/chapter5/">
      
      
        <link rel="prev" href="../chapter4/">
      
      
        <link rel="next" href="../../SoftwareTest/">
      
      
        
      
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Chapter5 Cache/Memory - LiHuaMao 的小站</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter5-cachememory" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="LiHuaMao 的小站" class="md-header__button md-logo" aria-label="LiHuaMao 的小站" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LiHuaMao 的小站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter5 Cache/Memory
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../DiffusionModel/" class="md-tabs__link">
          
  
  
    
  
  Diffusion Model

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../experience/" class="md-tabs__link">
          
  
  
    
  
  经验贴整理

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../PostTraining/RLHF/" class="md-tabs__link">
          
  
  
    
  
  模型后训练

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../UML/" class="md-tabs__link">
          
  
  
    
  
  课程笔记

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
  
    
  
  关于我

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LiHuaMao 的小站" class="md-nav__button md-logo" aria-label="LiHuaMao 的小站" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    LiHuaMao 的小站
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    标签
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    归档
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    归档
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/archive/2026/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2026
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../DiffusionModel/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Diffusion Model
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Diffusion Model
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/FlowMatching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [CFM Overviw] Flow Matching 流匹配
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/ConsistencyModel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consistency Model 一致性模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/RectifiedFlow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rectified Flow 修正流
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/DistributionMatching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distribution Matching Distillation 分布匹配蒸馏
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/UnderstandingDiffusionModels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding Diffusion Models: A Unified Perspective
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/Diff-Instruct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diff-Instruct Distillation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/DreamDiffusion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ProlificDream &amp; DreamDiffusion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/MeanFlow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mean Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiffusionModel/SelfDistillation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Learnig Flow Map via Self Distillation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../experience/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    经验贴整理
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    经验贴整理
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../experience/algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    算法岗面经
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../experience/cc98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    校内资源贴整理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../experience/softwareEngineer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    工程经验
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../experience/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    推荐学习资源
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../experience/others/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    其他
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    模型后训练
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    模型后训练
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PostTraining/RLHF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reforcement Learning from Human Feedback
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    课程笔记
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    课程笔记
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../UML/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    UML建模
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1" id="__nav_6_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    UML建模
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UML/UseCaseDiagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UML 用例图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UML/SequenceDiagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UML 序列图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UML/CommunicationDiagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UML 通信图（协作图）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" checked>
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    计算机系统原理
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    计算机系统原理
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter2 计算机的算数运算
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 3 RISC-V
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    chapter4 处理器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter5 Cache/Memory
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter5 Cache/Memory
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 总览
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 总览">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        存储器金字塔结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locality" class="md-nav__link">
    <span class="md-ellipsis">
      
        核心原理：局部性原理 (Locality)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        关键术语
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        存储层级间的数据传输
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 Cache
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache 的基本操作逻辑
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-direct-mapped" class="md-nav__link">
    <span class="md-ellipsis">
      
        3 直接映射 (Direct Mapped)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 直接映射 (Direct Mapped)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        映射规则：取模运算
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="映射规则：取模运算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例一：单字节block
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例二：多字节block
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址的拆分
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="地址的拆分">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例三：Cache 寻址
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        直接映射的内部结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="直接映射的内部结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例四：包含有效位的寻址
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        直接映射的硬件结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        优缺点分析
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        写策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        性能评价标准
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4 组关联映射
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 组关联映射">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-way" class="md-nav__link">
    <span class="md-ellipsis">
      
        基本结构：组 (Set) 与 路 (Way)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基本结构：组 (Set) 与 路 (Way)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例五：组关联映射
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址的拆分
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        工作原理：并行比对
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacement-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        替换算法 (Replacement Policy)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-virtual-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        6 Virtual Memory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 Virtual Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        为什么需要虚拟内存？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟地址的结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-translation" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址翻译(Address Translation)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        页表 (Page Table)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        多级页表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tlb-translation-lookaside-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      
        TLB (Translation Lookaside Buffer)：翻译加速器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-fault" class="md-nav__link">
    <span class="md-ellipsis">
      
        缺页异常 (Page Fault)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-protection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Protection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../SoftwareTest/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    软件测试与质量保证
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    软件测试与质量保证
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SoftwareTest/TestPlan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    测试计划
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SoftwareTest/TestCase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    测试用例
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SoftwareTest/TestExcute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    测试执行
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    关于我
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 总览
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 总览">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        存储器金字塔结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locality" class="md-nav__link">
    <span class="md-ellipsis">
      
        核心原理：局部性原理 (Locality)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        关键术语
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        存储层级间的数据传输
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 Cache
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache 的基本操作逻辑
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-direct-mapped" class="md-nav__link">
    <span class="md-ellipsis">
      
        3 直接映射 (Direct Mapped)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 直接映射 (Direct Mapped)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        映射规则：取模运算
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="映射规则：取模运算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例一：单字节block
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例二：多字节block
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址的拆分
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="地址的拆分">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例三：Cache 寻址
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        直接映射的内部结构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="直接映射的内部结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例四：包含有效位的寻址
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        直接映射的硬件结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        优缺点分析
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        写策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        性能评价标准
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4 组关联映射
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 组关联映射">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-way" class="md-nav__link">
    <span class="md-ellipsis">
      
        基本结构：组 (Set) 与 路 (Way)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基本结构：组 (Set) 与 路 (Way)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        示例五：组关联映射
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址的拆分
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        工作原理：并行比对
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacement-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        替换算法 (Replacement Policy)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-virtual-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        6 Virtual Memory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 Virtual Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        为什么需要虚拟内存？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        虚拟地址的结构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-translation" class="md-nav__link">
    <span class="md-ellipsis">
      
        地址翻译(Address Translation)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        页表 (Page Table)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        多级页表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tlb-translation-lookaside-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      
        TLB (Translation Lookaside Buffer)：翻译加速器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-fault" class="md-nav__link">
    <span class="md-ellipsis">
      
        缺页异常 (Page Fault)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-protection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Protection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter5-cachememory">Chapter5 Cache/Memory</h1>
<h2 id="1">1 总览</h2>
<p>存储器层次结构（Memory Hierarchy）的设计初衷是为了解决<strong>处理器速度快</strong>与<strong>存储器访问慢</strong>之间的矛盾，也就是常说的“存储墙”问题。其核心思想是利用<strong>局部性原理（Locality of Reference）</strong>，通过构建多层存储空间，在成本、容量和速度之间取得平衡。</p>
<hr />
<h3 id="_1">存储器金字塔结构</h3>
<p>存储器通常被组织成一个金字塔形，从上到下容量越来越大，速度越来越慢，但单位成本也越来越低：</p>
<ul>
<li><strong>寄存器 (Registers)</strong>：位于 CPU 内部，速度极快（与 CPU 同频），容量极小（通常仅几百字节）。</li>
<li><strong>高速缓存 (Cache)</strong>：分为 L1、L2、L3 三级。L1 最快但最小，L3 最慢但容量最大。它存储了 CPU 近期可能访问的数据。</li>
<li><strong>主存 (Main Memory/RAM)</strong>：存放当前正在运行的程序和数据。</li>
<li><strong>辅存 (Secondary Storage)</strong>：如 SSD 或 HDD，容量巨大且数据掉电不丢失，但访问速度比内存慢数千倍。</li>
</ul>
<hr />
<h3 id="locality">核心原理：局部性原理 (Locality)</h3>
<p>存储层次结构之所以有效，是因为程序运行具有以下两个特性：</p>
<ul>
<li><strong>时间局部性 (Temporal Locality)</strong>：如果一个数据被访问了，那么它在不久的将来很可能再次被访问（例如循环中的计数器）。</li>
<li><strong>空间局部性 (Spatial Locality)</strong>：如果一个数据被访问了，那么它相邻的数据在不久的将来也很可能被访问（例如遍历数组）。</li>
</ul>
<hr />
<h3 id="_2">关键术语</h3>
<p>在学习层次结构时，你会经常遇到以下概念：</p>
<ul>
<li><strong>命中 (Hit)</strong>：CPU 所需的数据在较高级别（较快）的存储器中找到。</li>
<li><strong>缺失 (Miss)</strong>：在较快存储器中找不到数据，必须向下一级索取。</li>
<li><strong>命中率 (Hit Rate)</strong>：命中次数占总访问次数的比例。</li>
<li><strong>缺失惩罚 (Miss Penalty)</strong>：处理一次缺失所需额外消耗的时间（通常包括将数据从低速层搬运到高速层的时间）。</li>
</ul>
<hr />
<h3 id="_3">存储层级间的数据传输</h3>
<p>数据在不同层级之间是以固定大小的块（Block/Line）为单位传输的。</p>
<ul>
<li><strong>Cache 与内存之间</strong>：传输单位通常是 <strong>Cache Line</strong>（如 64 字节）。</li>
<li><strong>内存与硬盘之间</strong>：传输单位通常是 <strong>页 (Page)</strong>（如 4KB）。</li>
</ul>
<hr />
<h2 id="2-cache">2 Cache</h2>
<p>既然我们已经了解了存储器层次结构的宏观“金字塔”模型，接下来我们需要深入探讨这一体系的核心：<strong>高速缓存（Cache）</strong>。</p>
<p>Cache 的存在是为了在 CPU 和主存之间架起一座桥梁。它利用<strong>局部性原理</strong>，将 CPU 最近可能用到的数据从慢速的主存搬运到快速的 Cache 中。</p>
<hr />
<h3 id="cache">Cache 的基本操作逻辑</h3>
<p>当 CPU 需要访问一个地址时：</p>
<ol>
<li><strong>命中 (Hit)</strong>：数据已在 Cache 中。CPU 以极快速度读取。</li>
<li><strong>缺失 (Miss)</strong>：数据不在 Cache 中。CPU 必须等待，从主存中将包含该数据的整个<strong>块（Block/Line）</strong>搬运到 Cache 中，然后再读取。</li>
</ol>
<hr />
<p><strong>地址映射（Mapping）</strong></p>
<p>内存很大（GB级别），Cache 很小（MB级别）。如何决定内存中的某个数据存放在 Cache 的哪个位置？主要有三种映射方案：直接映射，全相联映射，组相联映射。</p>
<p>A. 直接映射 (Direct Mapped)</p>
<ul>
<li><strong>规则</strong>：内存中的每个块只能存放在 Cache 中<strong>唯一</strong>确定的位置。</li>
<li><strong>计算</strong>：通常使用 <code>(块地址 % Cache块数)</code>。</li>
<li><strong>优缺点</strong>：硬件设计最简单，成本低；但容易发生<strong>碰撞（Conflict Miss）</strong>，如果两个经常使用的块映射到同一个位置，它们会互相踢出。</li>
</ul>
<p>B. 全相联映射 (Fully Associative)</p>
<ul>
<li><strong>规则</strong>：内存块可以存放在 Cache 的<strong>任何</strong>空闲位置。</li>
<li><strong>优缺点</strong>：空间利用率最高，碰撞概率最低；但硬件搜索极慢且昂贵，因为 CPU 必须同时检查 Cache 中的所有位置。</li>
</ul>
<p>C. 组相联映射 (Set Associative)</p>
<ul>
<li><strong>规则</strong>：这是前两者的折中方案。将 Cache 分成若干“组”，块映射到固定的组，但在组内可以存放在任何位置（例如“2路组相联”表示每组有两个位置）。</li>
<li><strong>现状</strong>：这是目前主流 CPU（如 Intel、AMD、ARM）最常用的方案。</li>
</ul>
<h2 id="3-direct-mapped">3 直接映射 (Direct Mapped)</h2>
<p><strong>直接映射 (Direct Mapped Cache)</strong> 是最简单的一种映射方式。它的核心思想是：内存中的每一个块（Block）在 Cache 中都有一个<strong>固定且唯一</strong>的对应位置。</p>
<p>你可以把它想象成“按门牌号入座”：内存空间被分成了很多个小组，每个小组的成员只能去 Cache 里的那个特定位置。</p>
<hr />
<h3 id="_4"><strong>映射规则：取模运算</strong></h3>
<p>内存地址到 Cache 位置的对应关系通常通过<strong>取模（Modulo）</strong>运算来实现：</p>
<div class="arithmatex">\[Cache 索引 = (内存块地址) \mod (Cache 中的总块数)\]</div>
<p>例如，如果你的 Cache 有 8 个槽位（Index 0-7）：</p>
<ul>
<li>内存第 0 块、第 8 块、第 16 块... 都会映射到 <strong>Cache Index 0</strong>。</li>
<li>内存第 1 块、第 9 块、第 17 块... 都会映射到 <strong>Cache Index 1</strong>。</li>
</ul>
<h4 id="block">示例一：单字节block</h4>
<p><img alt="image-20260102002046241" src="../assets/image-20260102002046241.png" /></p>
<p>以这个cs61c的示例图为例，此时cache中一共有4个block，每个block大小为1字节。将内存按照block大小分块，然后对4取余，那么余数为0的就到index为0的缓存块中。从颜色可以直观的看出这个映射规律。</p>
<h4 id="block_1">示例二：多字节block</h4>
<p><img alt="image-20260102002623533" src="../assets/image-20260102002623533.png" /></p>
<p>在这个例子中，一个block的大小增大到2字节，也就是cache中的一行。但是我们依然可以将内存按照block大小分块，然后对应取余。</p>
<p>这个时候有两个问题：</p>
<ol>
<li>当我请求一个block中的一个字节时，我会取来一个字节还是这一整个block（一整行）？</li>
<li>当我请求一个block中的字节时，我怎么知道他在这一行的哪个位置？</li>
</ol>
<p>对于第一个问题：前面的基本操作逻辑已经提到了，我们会取来这一整个block。这是空间局部性原理导致的，如果一个数据块被访问了，那么他相邻的数据块很有可能也会被访问到。而我们去内存取一次数据的开销是十分昂贵的。去cache取数据就像去书桌上拿一本书，而去内存取一次数据就像开车到市中心图书馆取书。此时如果你说我想读一本关于计算机系统原理的书，你就会顺手带两本和他相关的书，避免下一次要再开车来一次。</p>
<p>对于第二个问题，这就引出了我们在cache中是如何给字节标定地址的。</p>
<hr />
<h3 id="_5">地址的拆分</h3>
<p>为了在 Cache 中快速找到数据并确认它是不是我们要的那一个，CPU 会将 32 位（或 64 位）的内存地址拆解为三个部分：</p>
<ul>
<li><strong>标记 (Tag)</strong>：地址的高位部分。它用来区分映射到同一个 Cache Index 的不同内存块。</li>
<li><strong>索引 (Index)</strong>：中间部分。用来确定数据应该存放在 Cache 的哪一行（Row）。</li>
<li><strong>块偏移 (Block Offset)</strong>：低位部分。用来确定数据在某一个 Cache 块内的具体字节位置。</li>
</ul>
<p><img alt="image-20260102005633475" src="../assets/image-20260102005633475.png" /></p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><img alt="image-20260102003717613" src="../assets/image-20260102003717613.png" /></p>
<p>这个图演示了Tag是如何确定的，将内存按照Cache的大小分组，我们需要知道这个block是哪个组的block。</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><img alt="image-20260102003854521" src="../assets/image-20260102003854521.png" /></p>
<p>这个图演示了Cache中的具体布局，想要计算一个cache到底能存多少字节的数据，就要知道包含多少个block(Height)，一个block（一行）包含多少字节(Width)</p>
</div>
<h4 id="cache_1">示例三：Cache 寻址</h4>
<p><img alt="image-20260102004143637" src="../assets/image-20260102004143637.png" /></p>
<p>以这个图为例，Cache中一个Tag = 0, Index = 0, offset = 0 的字节，对应内存第一个分组，行数为0，offset = 0，也就是从第一行右起第一个位置的字节。offset + 1时，向左移一个字节。</p>
<hr />
<h3 id="_6">直接映射的内部结构</h3>
<p>每一个 Cache 槽位（Entry）由三部分组成：</p>
<ol>
<li><strong>有效位 (Valid Bit)</strong>：标记该位置是否有有效数据（1表示有，0表示为空或无效）。</li>
<li><strong>标记 (Tag)</strong>：存储该位置当前存放的内存块的高位地址。</li>
<li><strong>数据 (Data)</strong>：存储从内存搬运过来的实际数据块。</li>
</ol>
<h4 id="_7">示例四：包含有效位的寻址</h4>
<p><img alt="image-20260102005942772" src="../assets/image-20260102005942772.png" /></p>
<p>根据地址我们可以找到字节在Cache中对应的位置，但是事实是，在找到对应Index之后，我们要做的第一件事不是对比Tag是否一致，而是判断有效位是否为1。如果一个Cache刚被启用，那么所有的数据都是空的，有效位都置0，里面都是垃圾，这时候我们可以说这个cache是“冷的”。</p>
<hr />
<h3 id="_8">直接映射的硬件结构</h3>
<p><img alt="image-20260102010332873" src="../assets/image-20260102010332873.png" /></p>
<hr />
<h3 id="_9">优缺点分析</h3>
<ul>
<li><strong>优点</strong>：</li>
<li><strong>硬件极其简单</strong>：不需要复杂的查找电路，只需要一个比较器检查 Tag 是否匹配即可。</li>
<li><strong>访问速度快</strong>：因为位置是唯一的，CPU 可以直接跳到目标位置。</li>
<li><strong>成本低</strong>：逻辑门数量少。</li>
<li><strong>缺点（碰撞问题）</strong>：</li>
<li><strong>冲突缺失 (Conflict Miss)</strong>：这是它的致命伤。如果程序频繁地在内存第 0 块和第 8 块之间切换（它们都映射到 Index 0），Cache 就会不断地发生“踢出-搬运-再踢出”的循环，这被称为 <strong>Cache 抖动 (Thrashing)</strong>。</li>
</ul>
<hr />
<h3 id="_10">写策略</h3>
<p>当 CPU 修改了 L1 Cache 中的数据时，主存（Main Memory）里的对应数据就会变得“过期”。如何同步这些修改，主要有两种策略：<strong>写穿透</strong>和<strong>写回</strong>。</p>
<hr />
<p><strong>写穿透 (Write-Through)</strong></p>
<p>这是最保守、最简单的做法。</p>
<ul>
<li><strong>操作逻辑</strong>：每次 CPU 往 Cache 里写数据时，数据会<strong>同时</strong>被写入 Cache 和下一级存储（如主存）。</li>
<li><strong>优点</strong>：</li>
<li><strong>数据一致性好</strong>：主存里的数据永远是最新的，维护起来非常简单。</li>
<li><strong>实现简单</strong>：发生缺失（Miss）时不需要考虑复杂的写回逻辑。</li>
<li><strong>缺点</strong>：</li>
<li><strong>效率极低</strong>：由于内存速度比 CPU 慢百倍，每次写操作都要等内存确认，CPU 会被严重拖慢。</li>
<li><strong>优化：写缓冲 (Write Buffer)</strong>：为了缓解速度差，通常会在 CPU 和内存间加一个“小推车”（Buffer）。CPU 把数据扔进缓冲就走，由缓冲慢慢写往内存。</li>
</ul>
<hr />
<p><strong>写回 (Write-Back)</strong></p>
<p>这是现代高性能 CPU（如 Intel、AMD、ARM）普遍采用的方案。</p>
<ul>
<li><strong>操作逻辑</strong>：CPU 修改数据时，<strong>只更新 Cache</strong>，并不立刻写回主存。</li>
<li><strong>脏位 (Dirty Bit)</strong>：为了记住哪些数据被改过，Cache 每一行会多加一个 <code>Dirty bit</code>。</li>
<li>如果该块被修改过，<code>Dirty bit</code> 设为 1。</li>
<li>如果没被修改过，<code>Dirty bit</code> 为 0。</li>
<li><strong>触发写回</strong>：只有当这个“脏块”因为要给新数据腾位置而被<strong>踢出 (Evict)</strong> 时，硬件才会检查 <code>Dirty bit</code> 并将其内容写回主存。</li>
<li><strong>优点</strong>：</li>
<li><strong>性能极高</strong>：绝大多数写操作都在极快的 Cache 中完成，大大减少了对总线和内存的占用。</li>
<li><strong>缺点</strong>：</li>
<li><strong>逻辑复杂</strong>：需要处理脏位检测和踢出时的写回动作。</li>
</ul>
<hr />
<p><strong>写缺失 (Write Miss) 的处理</strong></p>
<p>如果 CPU 想写一个数据，但它不在 Cache 里，该怎么办？</p>
<ol>
<li><strong>写分配 (Write Allocate)</strong>：把数据从内存取到 Cache 里，然后再写。通常搭配<strong>写回</strong>策略。</li>
<li><strong>非写分配 (No Write Allocate)</strong>：直接在内存里写，不进 Cache。通常搭配<strong>写穿透</strong>策略。</li>
</ol>
<hr />
<h3 id="_11">性能评价标准</h3>
<p>存储器层次结构的好坏主要由 平均访存时间 (AMAT) 决定：</p>
<div class="arithmatex">\[AMAT = \text{命中时间} + (\text{缺失率} \times \text{缺失惩罚})\]</div>
<ul>
<li>命中时间 (Hit Time)：</li>
</ul>
<p>当数据就在当前层级（如 L1 Cache）时，读取它所需的时间。这通常非常短（例如 1~2 个时钟周期）。</p>
<ul>
<li>缺失率 (Miss Rate)：</li>
</ul>
<p>CPU 访问当前层级却找不到所需数据的概率（即 <span class="arithmatex">\(1 - \text{命中率}\)</span>）。</p>
<ul>
<li>缺失惩罚 (Miss Penalty)：</li>
</ul>
<p>一旦发生缺失，CPU 为了从更低一级存储（如主存）获取数据并搬运回高速缓存所付出的额外代价。</p>
<hr />
<h2 id="4">4 组关联映射</h2>
<p>组相联映射（Set Associative Mapping）是存储器设计中的一种折中方案，它巧妙地结合了直接映射的低成本/高速度与全相联映射的高灵活性/低缺失率。在主流 CPU 中，这是最常采用的 Cache 映射方式。</p>
<hr />
<h3 id="set-way">基本结构：组 (Set) 与 路 (Way)</h3>
<p>组相联将 Cache 划分为若干个“组”（Set），每一组内包含固定数量的“位置”（槽位），每个位置被称为一个“路”（Way）。</p>
<ul>
<li><strong>N 路组相联 (N-way Set Associative)</strong>：意味着每一组里有 <span class="arithmatex">\(N\)</span> 个槽位。</li>
<li><strong>映射规则</strong>：内存中的一个块（Block）根据地址映射到一个<strong>固定的组</strong>，但在该组内部，它可以存放在 <strong><span class="arithmatex">\(N\)</span> 个路中的任何一个</strong>位置。</li>
</ul>
<blockquote>
<p><strong>比喻</strong>：直接映射就像是“对号入座”的电影院（每人只能坐一个指定座）；组相联就像是“包厢制”餐厅（你被分配到 3 号包厢，但包厢里的 4 把椅子你可以随便挑一把坐）。</p>
</blockquote>
<h4 id="_12">示例五：组关联映射</h4>
<p><img alt="image-20260102011427103" src="../assets/image-20260102011427103.png" /></p>
<p>在这个红配绿赛狗史的图中，我们可以理解，就是按照取余分组之后，内存中同一个余数可以对应不同的index了。</p>
<p>这解决了抖动的问题，也就是说，假如我在循环中需要反复把A的值赋给B，而AB恰好在不同组，但是余数相同的块（也就是说在两个不同的绿块中），如果是直接映射，先取A再取B的操作必然会导致缓存中的冲突，一个循环内至少要去内存取一次A，发生冲突再去一次B，造成了严重的时间惩罚，但是只要有两个位置的组关联映射就能完美解决这个问题。</p>
<hr />
<h3 id="_13">地址的拆分</h3>
<p>与直接映射类似，32 位地址被拆分为三个部分，但由于结构的改变，位数的分配发生了变化：</p>
<ul>
<li><strong>索引 (Index)</strong>：用于定位数据属于哪一个“组”。</li>
<li><strong>标记 (Tag)</strong>：用于在选定的组内，通过并行比对来确认哪一路存放的是目标数据。</li>
<li><strong>偏移 (Offset)</strong>：用于在块内定位具体的字节。</li>
</ul>
<hr />
<h3 id="_14">工作原理：并行比对</h3>
<p>当 CPU 访问组相联 Cache 时，会发生以下动作：</p>
<ol>
<li><strong>定位组</strong>：根据 <strong>Index</strong> 找到对应的组。</li>
<li><strong>并行比对</strong>：将地址中的 <strong>Tag</strong> 同时发送给该组内的<strong>所有路</strong>。</li>
<li><strong>判定命中</strong>：如果某一路的 <strong>Tag 匹配</strong> 且 <strong>有效位 (Valid bit)</strong> 为 1，则 Cache 命中。</li>
</ol>
<p><img alt="image-20260102011916903" src="../assets/image-20260102011916903.png" /></p>
<hr />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>为什么组相联更好？（解决“抖动”问题）</p>
<p>组相联最大的优势是极大地缓解了<strong>冲突缺失 (Conflict Miss)</strong>。</p>
<ul>
<li><strong>直接映射的弱点</strong>：如果两个频繁使用的内存块映射到同一个 Index，它们会不停地互相踢出（Cache 抖动）。</li>
<li><strong>组相联的解法</strong>：在组相联中，这两个块可以同时存在于同一个组的不同“路”中，互不干扰。实验表明，<strong>2路或4路组相联</strong>就能消除大部分的冲突缺失。</li>
</ul>
</div>
<hr />
<h3 id="replacement-policy">替换算法 (Replacement Policy)</h3>
<p>由于一组内有多个位置，当组满了又要搬进新数据时，硬件必须决定“踢走谁”。常用的算法包括：</p>
<ul>
<li><strong>LRU (Least Recently Used)</strong>：踢走最久没被访问过的那一个。</li>
<li><strong>Random</strong>：随机踢走一个（简单但有效）。</li>
</ul>
<hr />
<h2 id="6-virtual-memory">6 Virtual Memory</h2>
<p>虚拟内存（Virtual Memory）是计算机系统中最伟大的“幻觉”之一。它在每个程序和物理内存条（DRAM）之间建立了一个抽象层，让程序员觉得自己的程序拥有一个连续、私有且巨大的地址空间。</p>
<hr />
<h3 id="_15">为什么需要虚拟内存？</h3>
<p>在早期的计算机中，程序直接访问物理内存。这会导致两个严重问题：</p>
<ul>
<li><strong>空间不足</strong>：如果物理内存只有 8GB，你无法运行一个需要 16GB 的大型游戏。</li>
<li><strong>安全性差</strong>：一个程序的错误（比如野指针）可能会直接修改另一个程序的数据，甚至破坏操作系统。</li>
</ul>
<p><strong>虚拟内存通过以下方式解决这些问题：</strong></p>
<ol>
<li><strong>扩展空间</strong>：利用磁盘（HDD/SSD）作为内存的延伸，让程序可以运行在比物理内存更大的空间里。</li>
<li><strong>内存保护</strong>：每个程序都有独立的“虚拟地址空间”，互不干扰。</li>
<li><strong>简化编程</strong>：程序员不再需要担心物理内存的具体分配，只需在统一的虚拟空间里编写代码。</li>
</ol>
<hr />
<h3 id="_16">虚拟地址的结构</h3>
<p>无论是 32 位还是 64 位系统，虚拟地址在逻辑上都被划分为两个关键部分：</p>
<p><strong>A. VPN (Virtual Page Number) —— 虚拟页号</strong></p>
<ul>
<li><strong>定义</strong>：这是地址的高位部分。它代表该地址属于虚拟地址空间中的<strong>哪一页</strong>。</li>
<li><strong>作用</strong>：它是<strong>页表的索引</strong>。CPU 拿着 VPN 去查页表，寻找它对应的物理页（PPN）。</li>
<li><strong>特性</strong>：VPN 的位数决定了一个进程最多可以拥有多少个虚拟页。</li>
</ul>
<p><strong>B. VPO (Virtual Page Offset) —— 虚拟页内偏移量</strong></p>
<ul>
<li><strong>定义</strong>：这是地址的低位部分。它代表该地址在某一个 4KB 页面内部的具体位置。</li>
<li><strong>作用</strong>：一旦确定了物理页，偏移量直接决定了我们要读的是页内的哪一个字节。</li>
<li><strong>特性</strong>：<strong>偏移量的位数由页的大小（Page Size）唯一决定。</strong></li>
</ul>
<hr />
<div class="admonition example">
<p class="admonition-title">实例计算：位数是如何分配的？</p>
<p>假设我们使用最常见的 <strong>4KB 页大小</strong>（<span class="arithmatex">\(4KB = 2^{12} \text{ bytes}\)</span>）：</p>
<p><strong>在 32 位系统中（单级页表）：</strong></p>
<ul>
<li><strong>低 12 位</strong>：是 <strong>VPO</strong>（因为 <span class="arithmatex">\(2^{12}\)</span> 正好覆盖 4096 个字节）。</li>
<li><strong>高 20 位</strong>：是 <strong>VPN</strong>（<span class="arithmatex">\(32 - 12 = 20\)</span> 位）。</li>
<li>这意味着一个程序理论上可以有 <span class="arithmatex">\(2^{20}\)</span>（约 100 万）个虚拟页。</li>
</ul>
<p><strong>在 48 位虚拟地址系统中（多级页表）：</strong></p>
<ul>
<li><strong>低 12 位</strong>：依然是 <strong>VPO</strong>。</li>
<li><strong>高 36 位</strong>：是 <strong>VPN</strong>（<span class="arithmatex">\(48 - 12 = 36\)</span> 位）。</li>
<li><strong>多级划分</strong>：这 36 位的 VPN 会进一步被拆分为 4 段（每段 9 位）</li>
</ul>
</div>
<hr />
<h3 id="address-translation">地址翻译(Address Translation)</h3>
<p>CPU 产生的地址是<strong>虚拟地址 (Virtual Address, VA)</strong>，而内存条识别的是<strong>物理地址 (Physical Address, PA)</strong>。</p>
<ul>
<li><strong>MMU (Memory Management Unit)</strong>：这是 CPU 内部的一个硬件单元，负责实时将 VA 翻译成 PA。</li>
<li><strong>页 (Page)</strong>：虚拟内存将空间划分为固定大小的块（通常是 <strong>4KB</strong>）。虚拟空间的块叫“虚拟页”，物理空间的块叫“物理页帧”。</li>
</ul>
<p><img alt="image-20260102132605517" src="../assets/image-20260102132605517.png" /></p>
<hr />
<h3 id="page-table">页表 (Page Table)</h3>
<p>页表是存储在内存中的一张“转换表”，记录了虚拟页和物理页帧之间的对应关系。</p>
<ul>
<li><strong>页表项 (PTE)</strong>：每一行代表一个映射。它不仅包含物理地址，还包含：</li>
<li><strong>有效位 (Valid Bit)</strong>：标记该页是否已经在物理内存中。</li>
<li><strong>权限位 (R/W/X)</strong>：规定该页是只读、可写还是可执行。</li>
<li><strong>脏位 (Dirty Bit)</strong>：标记该页是否被修改过（用于写回磁盘）。</li>
</ul>
<p><img alt="image-20260102132646736" src="../assets/image-20260102132646736.png" /></p>
<div class="admonition example">
<p class="admonition-title">实例说明：虚拟地址如何映射到物理地址</p>
<p>假设我们有一个简化的系统：</p>
<ul>
<li><strong>虚拟地址空间</strong>：<span class="arithmatex">\(2^{32}\)</span> 字节（4GB），地址长度为 <strong>32 位</strong>。</li>
<li><strong>物理内存</strong>：<span class="arithmatex">\(2^{30}\)</span> 字节（1GB）。</li>
<li><strong>页大小 (Page Size)</strong>：<span class="arithmatex">\(2^{12}\)</span> 字节（<strong>4KB</strong>）。</li>
</ul>
<p>32 位的虚拟地址（VA）被分为两个部分：</p>
<ol>
<li><strong>虚拟页号 (VPN)</strong>：高 20 位（<span class="arithmatex">\(32 - 12 = 20\)</span>），用来在页表中找“行”。</li>
<li><strong>页偏移 (Offset)</strong>：低 12 位，对应 4KB 内的具体字节位置（映射前后保持不变）。</li>
</ol>
<p>假设程序访问虚拟地址 <code>0x00002005</code>：</p>
<ol>
<li><strong>拆分</strong>：VPN = <code>0x00002</code>，Offset = <code>0x005</code>。</li>
<li><strong>查表</strong>：CPU 查找页表第 <strong>2</strong> 行（PTE 2）。</li>
<li><strong>提取</strong>：假设 PTE 2 中存储的<strong>物理页帧号 (PPN)</strong> 是 <code>0x1AB23</code>。</li>
<li><strong>组合</strong>：物理地址 = PPN + Offset = <code>0x1AB23005</code>。</li>
</ol>
</div>
<hr />
<h3 id="_17">多级页表</h3>
<p>以目前主流的 <strong>x86-64 架构（48 位虚拟地址）</strong> 为例，计算一下为什么不使用多级页表会导致系统直接瘫痪。</p>
<p>在 64 位机器上，硬件通常只物理实现 48 位虚拟地址（剩下的高位用于符号扩展），但这已经足够恐怖了：</p>
<ul>
<li><strong>虚拟地址空间</strong>：<span class="arithmatex">\(2^{48}\)</span> 字节 = <strong>256 TB</strong>。</li>
<li><strong>页大小 (Page Size)</strong>：依然是 <strong>4 KB</strong> (<span class="arithmatex">\(2^{12}\)</span>)。</li>
<li><strong>页表项 (PTE) 大小</strong>：在 64 位系统中，物理地址更长，每个 PTE 需要 <strong>8 字节</strong>。</li>
</ul>
<p>如果使用“一级页表”：</p>
<ol>
<li><strong>计算页数</strong>：<span class="arithmatex">\(2^{48} \div 2^{12} = 2^{36}\)</span> 个页表项（约 <strong>687 亿</strong>行）。</li>
<li><strong>计算页表大小</strong>：<span class="arithmatex">\(2^{36} \times 8 \text{ Bytes} = 2^{39} \text{ Bytes} = \mathbf{512 GB}\)</span>。</li>
</ol>
<p><strong>结论</strong>：如果你用一级页表，光是存储“地图”本身就需要 <strong>512GB</strong> 的内存。这意味着即使你的电脑插了 32GB 内存条，连一个进程的页表都放不下，系统根本无法启动。</p>
<hr />
<p><strong>多级页表如何解决这个问题？（以四级页表为例）</strong></p>
<p>为了处理这 48 位地址，x86-64 采用了 四级页表 结构。它将 48 位地址拆分为：</p>
<p>9位 (L4) + 9位 (L3) + 9位 (L2) + 9位 (L1) + 12位 (Offset)</p>
<p>为什么 4 级页表能跑起来？</p>
<ol>
<li>按需加载的极致体现：</li>
</ol>
<p>虽然总虚拟空间是 256TB，但一个普通的程序（比如记事本）可能只用了 50MB。</p>
<ul>
<li>在四级结构下，绝大多数“目录项”都是空的。</li>
<li><strong>只有真正存放了代码和数据的地址，硬件才会为其分配下一级的页表页</strong>。</li>
<li>
<p>对于这 50MB 的程序，实际占用的页表可能只有几百 KB。</p>
</li>
<li>
<p>分散存储：</p>
</li>
</ul>
<p>每一级页表的大小刚好是 <span class="arithmatex">\(2^9 \times 8 \text{ Bytes} = 4 \text{ KB}\)</span>。这非常精妙——一个页表块的大小正好等于一个物理页的大小。这使得操作系统可以像管理普通数据一样，把页表散落在内存的任何角落，而不需要 512GB 的连续空间。</p>
<hr />
<p><strong>地址翻译</strong></p>
<p>在1级页表中，satp根页表寄存器直接指向所需的页表，4级页表只是变成一个树形结构，satp依旧指向根页表</p>
<p>当你访问地址 <code>0x0000 1234 5678 9ABC</code> 时：</p>
<ol>
<li><strong>L4 索引</strong>：硬件截取地址的高位（VA[47:39]）。从 <code>satp</code> 指向的根页表中找到对应项。如果该项有效，它指向 L3 页表的地址。</li>
<li><strong>L3 索引</strong>：硬件截取 VA[38:30]。在 L3 页表中查找，找到 L2 页表的地址。</li>
<li><strong>L2 索引</strong>：硬件截取 VA[29:21]。在 L2 页表中查找，找到 L1 页表的地址。</li>
<li><strong>L1 索引</strong>：硬件截取 VA[20:12]。在 L1 页表中查找。这一项（PTE）存的是<strong>真实物理页号 (PPN)</strong>。</li>
<li><strong>拼接物理地址</strong>：把拿到的 <strong>PPN</strong> 放在高位，拼接上原始地址最后 12 位的 <strong>Offset</strong>（即 <code>0xABC</code>），得到最终的物理地址。</li>
</ol>
<p><img alt="image-20260102140141520" src="../assets/image-20260102140141520.png" /></p>
<p>这是一个三级页表的查找过程，可以类比一下</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>只有最后一级L1存了真实物理地址，前面都是存的下一级页表的地址。</p>
<p>如果查询到这一行，这一行是无效的，没有下一级页表（或者对应物理地址），说明这一块内存还没被人用过，这是硬件不负责分配地址，会抛出一个PageFault，让os重新分配页表项。</p>
</div>
<hr />
<p><strong>这种设计的代价：性能损失</strong></p>
<p>多级页表虽然省了空间，但带来了一个致命问题：<strong>慢</strong>。</p>
<ul>
<li><strong>一级页表</strong>：访存 1 次（查表）+ 访存 1 次（取数）= 2 次。</li>
<li><strong>四级页表</strong>：访存 4 次（逐级查表）+ 访存 1 次（取数）= <strong>5 次</strong>。</li>
</ul>
<p>如果不做优化，你的 CPU 性能会直接下降到原来的 20%。</p>
<p><strong>这就是为什么 TLB（翻译后备缓冲器）至关重要。</strong></p>
<hr />
<h3 id="tlb-translation-lookaside-buffer">TLB (Translation Lookaside Buffer)：翻译加速器</h3>
<p>由于页表存储在主存中，每次访存都要先查页表再取数据，这会让速度慢一倍。</p>
<ul>
<li><strong>TLB 作用</strong>：它是 MMU 内部的一个小型硬件 <strong>Cache</strong>，专门存放最近用过的页表项。</li>
<li><strong>效果</strong>：绝大多数地址翻译都能在 TLB 中瞬间完成（通常只需 1 个周期），极大地提高了效率。</li>
</ul>
<hr />
<h3 id="page-fault">缺页异常 (Page Fault)</h3>
<p>当程序访问一个有效位为 0 的虚拟页时，会触发<strong>缺页异常</strong>：</p>
<ol>
<li>CPU 暂停当前程序，跳转到操作系统的缺页处理程序。</li>
<li>操作系统去磁盘中找到缺失的数据块。</li>
<li>将数据搬运到物理内存中一个空闲的页帧。</li>
<li>更新页表中的物理地址和有效位。</li>
<li>重新执行刚才报错的指令。</li>
</ol>
<hr />
<h3 id="memory-protection">Memory Protection</h3>
<p><strong>内存保护（Memory Protection）</strong> 是虚拟内存最强大的副产品。如果说虚拟内存是为了“扩充空间”，那么内存保护就是为了“建立边界”。</p>
<p>在没有内存保护的年代，一个程序的错误（比如野指针）可以直接改写操作系统的核心数据，导致系统彻底崩溃。而现在，操作系统利用<strong>页表项（PTE）</strong>中的“权限位”，给每一块内存都加上了保险锁。</p>
<hr />
<p><strong>内存保护的核心：页表项中的“权限位”</strong></p>
<p>每一条页表项不仅记录了物理地址，还额外存储了几个 bit，用来描述这块内存的<strong>访问规则</strong>：</p>
<ul>
<li><strong>V (Valid)</strong>：该页是否在内存中。访问无效页会触发 <strong>Page Fault</strong>。</li>
<li><strong>R/W (Read/Write)</strong>：读写控制。如果设为只读（Read-only），尝试写入会触发异常。</li>
<li><strong>U/S (User/Supervisor)</strong>：用户/内核特权级。防止普通程序访问操作系统内核的地址空间。</li>
<li><strong>NX/XD (No-Execute)</strong>：禁止执行位。标记这块内存只能存数据，不能当代码跑。</li>
</ul>
<hr />
<p><strong>常见的保护场景</strong></p>
<p><strong>A. 防止程序互扰（地址空间隔离）</strong></p>
<p>每个进程都有自己独立的页表。进程 A 的虚拟地址 <code>0x4000</code> 映射到物理页 <code>10</code>，而进程 B 的虚拟地址 <code>0x4000</code> 映射到物理页 <code>20</code>。</p>
<p><strong>结果</strong>：两个程序虽然地址一样，但互不透明，完全无法修改对方的数据。</p>
<p><strong>B. 防止篡改代码（只读保护）</strong></p>
<p>程序的代码段（Code Segment）在页表中会被标记为 <strong>Read-only</strong>。</p>
<p><strong>结果</strong>：如果程序试图修改自己的指令，CPU 会立刻拦截并抛出 <code>Segmentation Fault</code>。</p>
<p><strong>C. 防止缓冲区溢出攻击（NX 位）</strong></p>
<p>黑客常利用漏洞往“栈（Stack）”里写入恶意代码并运行。</p>
<p><strong>结果</strong>：现代系统将栈内存标记为 <strong>NX (不可执行)</strong>。即便黑客写进去了代码，CPU 也会因为该页禁止执行而拒绝运行。</p>
<hr />
<p><strong>特权级切换</strong></p>
<p>虚拟地址空间通常被划分为 <strong>用户空间（User Space）</strong> 和 <strong>内核空间（Kernel Space）</strong>。</p>
<ul>
<li>当 CPU 处于 <strong>User Mode</strong> 时，MMU 会检查页表中的 <strong>U/S 位</strong>。如果用户程序尝试访问标记为 <code>Supervisor</code> 的内核地址，硬件会直接切断连接。</li>
<li>只有通过特定的“系统调用（System Call）”让 CPU 进入 <strong>Kernel Mode</strong> 后，才能合法访问内核数据。</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>OS 设置规则</strong>：操作系统在创建页表时，决定了哪块内存能写、哪块能跑。</p>
<p><strong>MMU 强制执行</strong>：CPU 每次访存都会检查这些位。只要不符合规则，硬件立刻停机。</p>
</div>







  
  






  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
    data-repo="LiHuaMao0810/MkDocsNote"
    data-repo-id="R_kgDOQP2iHw"
    data-category="Q&A"
    data-category-id="DIC_kwDOQP2iH84CxfBk"
    data-mapping="url"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async>
  </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.sections", "navigation.top", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
    
  </body>
</html>